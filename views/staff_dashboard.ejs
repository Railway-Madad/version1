<!DOCTYPE html>
<html lang="en">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Rail Madad - Staff Dashboard</title>
     <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
     <link rel="stylesheet" href="css/style.css">
     <style>
         
         /* Navigation */
         .navbar {
             background-color: #fff;
             box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
             padding: 15px 0;
             position: sticky;
             top: 0;
             z-index: 1000;
         }
         
         .container {
             width: 100%;
             max-width: 1200px;
             margin: 0 auto;
             padding: 0 20px;
         }
         
         .nav-container {
             display: flex;
             justify-content: space-between;
             align-items: center;
         }
         
         .logo {
             display: flex;
             align-items: center;
             font-size: 1.6rem;
             font-weight: 700;
             color: var(--primary-color);
             text-decoration: none;
         }
         
         .logo i {
             margin-right: 10px;
             color: var(--secondary-color);
         }
         
         .user-section {
             display: flex;
             align-items: center;
         }
         
         .user-name {
             margin-right: 15px;
             font-weight: 500;
             color: var(--text-dark);
         }
         
         .logout-btn {
             display: inline-block;
             padding: 8px 16px;
             background-color: var(--primary-color);
             color: white;
             border: none;
             border-radius: 5px;
             text-decoration: none;
             font-weight: 600;
             cursor: pointer;
             transition: var(--transition);
             font-size: 0.9rem;
         }
         
         .logout-btn:hover {
             background-color: #164c91;
             transform: translateY(-2px);
         }
         
         /* Dashboard Content */
         .dashboard-container {
             flex: 1;
             padding: 40px 0;
         }
         
         .dashboard-header {
             margin-bottom: 30px;
         }
         
         .dashboard-header h3 {
             color: var(--primary-color);
             font-size: 1.8rem;
             margin-bottom: 5px;
         }
         
         .dashboard-header p {
             color: #666;
         }
         
         .card {
             background-color: white;
             border-radius: 10px;
             box-shadow: var(--card-shadow);
             margin-bottom: 30px;
             overflow: hidden;
         }
         
         .card-header {
             background-color: #fff;
             padding: 20px;
             border-bottom: 1px solid #eee;
             display: flex;
             justify-content: space-between;
             align-items: center;
         }
         
         .card-header h5 {
             color: var(--primary-color);
             font-size: 1.2rem;
             margin: 0;
         }
         
         .card-body {
             padding: 20px;
         }
         
         .card-footer {
             background-color: #fff;
             padding: 15px 20px;
             border-top: 1px solid #eee;
         }
         
         /* Table Styles */
         .table-responsive {
             overflow-x: auto;
         }
         
         table {
             width: 100%;
             border-collapse: collapse;
         }
         
         thead th {
             background-color: #f8f9fa;
             padding: 12px 15px;
             text-align: left;
             font-weight: 600;
             font-size: 0.9rem;
             color: #555;
             border-bottom: 2px solid #eee;
         }
         
         tbody td {
             padding: 12px 15px;
             border-bottom: 1px solid #eee;
             vertical-align: middle;
         }
         
         tbody tr:hover {
             background-color: rgba(26, 95, 180, 0.03);
         }
         
         /* Status Badge */
         .status-badge {
             padding: 5px 12px;
             border-radius: 20px;
             font-size: 0.75rem;
             font-weight: 600;
             display: inline-block;
         }
         
         .bg-warning {
             background-color: #ffeaa7;
             color: #d69e2e;
         }
         
         .bg-info {
             background-color: #bee3f8;
             color: #3182ce;
         }
         
         .bg-success {
             background-color: #c6f6d5;
             color: #38a169;
         }
         
         /* Action Buttons */
         .btn {
             display: inline-block;
             padding: 8px 12px;
             border-radius: 5px;
             font-weight: 500;
             cursor: pointer;
             transition: var(--transition);
             text-align: center;
             text-decoration: none;
             border: 1px solid transparent;
         }
         
         .btn-sm {
             padding: 6px 10px;
             font-size: 0.85rem;
         }
         
         .btn-primary {
             background-color: var(--primary-color);
             color: white;
         }
         
         .btn-outline-primary {
             border-color: var(--primary-color);
             color: var(--primary-color);
             background-color: transparent;
         }
         
         .btn-outline-primary:hover {
             background-color: var(--primary-color);
             color: white;
         }
         
         .btn-success {
             background-color: var(--secondary-color);
             color: white;
         }
         
         .btn-outline-success {
             border-color: var(--secondary-color);
             color: var(--secondary-color);
             background-color: transparent;
         }
         
         .btn-outline-success:hover {
             background-color: var(--secondary-color);
             color: white;
         }
         
         .btn-secondary {
             background-color: #718096;
             color: white;
         }
         
         /* Pagination */
         .pagination {
             display: flex;
             padding-left: 0;
             list-style: none;
             border-radius: 0.25rem;
             justify-content: center;
         }
         
         .page-item.active .page-link {
             background-color: var(--primary-color);
             border-color: var(--primary-color);
             color: white;
         }
         
         .page-item.disabled .page-link {
             color: #ccc;
             pointer-events: none;
             cursor: not-allowed;
         }
         
         .page-link {
             position: relative;
             display: block;
             padding: 8px 12px;
             margin-left: -1px;
             line-height: 1.25;
             color: var(--primary-color);
             background-color: #fff;
             border: 1px solid #dee2e6;
             text-decoration: none;
             transition: var(--transition);
         }
         
         .page-link:hover {
             background-color: #e9ecef;
         }
         
         /* Modal Styling */
         .modal {
             position: fixed;
             top: 0;
             left: 0;
             z-index: 1050;
             width: 100%;
             height: 100%;
             overflow: hidden;
             outline: 0;
             background-color: rgba(0, 0, 0, 0.5);
             display: none;
         }
         
         .modal.fade {
             transition: opacity 0.15s linear;
         }
         
         .modal.show {
             display: block;
         }
         
         .modal-dialog {
             position: relative;
             width: auto;
             margin: 1.75rem auto;
             max-width: 500px;
             pointer-events: none;
         }
         
         .modal-content {
             position: relative;
             display: flex;
             flex-direction: column;
             width: 100%;
             pointer-events: auto;
             background-color: #fff;
             border-radius: 10px;
             box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
             outline: 0;
         }
         
         .modal-header {
             display: flex;
             align-items: center;
             justify-content: space-between;
             padding: 1rem 1.5rem;
             border-bottom: 1px solid #eee;
         }
         
         .modal-title {
             margin: 0;
             font-size: 1.2rem;
             color: var(--primary-color);
         }
         
         .btn-close {
             background: transparent;
             border: none;
             font-size: 1.5rem;
             cursor: pointer;
             color: #aaa;
         }
         
         .modal-body {
             position: relative;
             flex: 1 1 auto;
             padding: 1.5rem;
         }
         
         .modal-footer {
             display: flex;
             justify-content: flex-end;
             padding: 1rem 1.5rem;
             border-top: 1px solid #eee;
         }
         
         /* Form Controls */
         .form-label {
             display: block;
             margin-bottom: 8px;
             font-weight: 500;
             color: #444;
         }
         
         .form-control {
             width: 100%;
             padding: 12px 15px;
             border: 1px solid #ddd;
             border-radius: 5px;
             transition: var(--transition);
             font-size: 1rem;
         }
         
         .form-control:focus {
             border-color: var(--primary-color);
             box-shadow: 0 0 0 3px rgba(26, 95, 180, 0.1);
             outline: none;
         }
         
         .form-select {
             display: block;
             width: 100%;
             padding: 12px 15px;
             font-size: 1rem;
             line-height: 1.5;
             color: #495057;
             background-color: #fff;
             background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
             background-repeat: no-repeat;
             background-position: right 1rem center;
             background-size: 16px 12px;
             border: 1px solid #ddd;
             border-radius: 5px;
             appearance: none;
         }
         
         .form-select:focus {
             border-color: var(--primary-color);
             box-shadow: 0 0 0 3px rgba(26, 95, 180, 0.1);
             outline: none;
         }
         
         .mb-3 {
             margin-bottom: 1rem;
         }
         
         /* Responsive */
         @media (max-width: 768px) {
             .card {
                 margin-bottom: 20px;
             }
             
             .modal-dialog {
                 margin: 1rem;
             }
         }
     </style>
 </head>
 <body>
     <nav class="navbar">
         <div class="container nav-container">
             <a href="/" class="logo">
                 <i class="fas fa-train"></i>
                 Rail Madad
             </a>
             <div class="user-section">
                 <span class="user-name"><%= staffName %></span>
                 <a href="/admin" class="logout-btn">Logout</a>
             </div>
         </div>
     </nav>
 
     <div class="dashboard-container">
         <div class="container">
             <div class="dashboard-header">
                 <h3>Staff Dashboard</h3>
                 <p>Welcome back, <%= staffName %>!</p>
             </div>
             
             <!-- Complaints List -->
             <div class="card">
                 <div class="card-header">
                     <h5>Complaints</h5>
                 </div>
                 <div class="card-body">
                     <div class="table-responsive">
                         <table>
                             <thead>
                                 <tr>
                                     <th>ID</th>
                                     <th>Passenger</th>
                                     <th>Issue Type</th>
                                     <th>PNR</th>
                                     <th>Date</th>
                                     <th>Status</th>
                                     <th>Actions</th>
                                 </tr>
                             </thead>
                             <tbody>
                                 <% complaints.forEach(complaint => { %>
                                     <tr>
                                         <td><%= complaint.id %></td>
                                         <td><%= complaint.username %></td>
                                         <td><%= complaint.issueDomain %></td>
                                         <td><%= complaint.pnr %></td>
                                         <td><%= new Date(complaint.createdAt).toLocaleDateString() %></td>
                                         <td>
                                             <span class="status-badge <%= complaint.status === 'Pending' ? 'bg-warning' : complaint.status === 'In Progress' ? 'bg-info' : 'bg-success' %>">
                                                 <%= complaint.status %>
                                             </span>
                                         </td>
                                         <td>
                                             <button class="btn btn-sm btn-outline-primary me-1" onclick="viewComplaint('<%= complaint.id %>')">
                                                 <i class="fas fa-eye"></i>
                                             </button>
                                             <% if (complaint.status !== 'Resolved') { %>
                                                 <button class="btn btn-sm btn-outline-success" onclick="showResolveModal('<%= complaint.id %>')">
                                                     <i class="fas fa-check"></i>
                                                 </button>
                                             <% } %>
                                         </td>
                                     </tr>
                                 <% }); %>
                             </tbody>
                         </table>
                     </div>
                 </div>
                 <div class="card-footer">
                     <nav>
                         <ul class="pagination justify-content-center mb-0">
                             <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                                 <a class="page-link" href="?page=<%= currentPage - 1 %>&username=<%= staffName %>">Previous</a>
                             </li>
                             <% for(let i = 1; i <= totalPages; i++) { %>
                                 <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                                     <a class="page-link" href="?page=<%= i %>&username=<%= staffName %>"><%= i %></a>
 
                                 </li>
                             <% } %>
                             <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                                 <a class="page-link" href="?page=<%= currentPage + 1 %>&username=<%= staffName %>">Next</a>
                             </li>
                         </ul>
                     </nav>
                 </div>
             </div>
         </div>
         
         <!-- View Complaint Modal -->
         <div class="modal fade" id="viewComplaintModal" tabindex="-1">
             <div class="modal-dialog">
                 <div class="modal-content">
                     <div class="modal-header">
                         <h5 class="modal-title">Complaint Details</h5>
                         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                     <div class="modal-body">
                         <div class="mb-3">
                             <h6>Complaint ID: <span id="viewComplaintId"></span></h6>
                             <h6>Status: <span id="viewComplaintStatus"></span></h6>
                         </div>
                         
                         <h6>Passenger Information</h6>
                         <p><strong>Username:</strong> <span id="viewPassengerName"></span></p>
                         <p><strong>PNR:</strong> <span id="viewPassengerPNR"></span></p>
                         
                         <h6>Complaint Details</h6>
                         <p><strong>Issue Type:</strong> <span id="viewIssueType"></span></p>
                         <p><strong>Created At:</strong> <span id="viewCreatedAt"></span></p>
                         <p><strong>Description:</strong></p>
                         <p id="viewDescription" class="border p-2 bg-light rounded"></p>
                     </div>
                     <div class="modal-footer">
                         <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                         <button type="button" id="resolveBtn" class="btn btn-success" onclick="showResolveModal(document.getElementById('viewComplaintId').textContent)">Resolve</button>
                     </div>
                 </div>
             </div>
         </div>
         
         <!-- Resolve Complaint Modal -->
         <div class="modal fade" id="resolveComplaintModal" tabindex="-1">
             <div class="modal-dialog">
                 <div class="modal-content">
                     <div class="modal-header">
                         <h5 class="modal-title">Resolve Complaint</h5>
                         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                     <div class="modal-body">
                         <form id="resolveComplaintForm">
                             <input type="hidden" id="resolveComplaintId" name="complaintId">
                             
                             <div class="mb-3">
                                 <label for="resolutionDetails" class="form-label">Resolution Details</label>
                                 <textarea class="form-control" id="resolutionDetails" name="resolutionDetails" rows="4" required></textarea>
                             </div>
                             
                             <div class="mb-3">
                                 <label for="resolutionCategory" class="form-label">Resolution Category</label>
                                 <select class="form-select" id="resolutionCategory" name="resolutionCategory" required>
                                     <option value="">Select Resolution Category</option>
                                     <option value="Issue Resolved">Issue Resolved</option>
                                     <option value="Alternative Solution Provided">Alternative Solution Provided</option>
                                     <option value="Compensation Provided">Compensation Provided</option>
                                     <option value="Referred to Higher Authority">Referred to Higher Authority</option>
                                     <option value="Not Actionable">Not Actionable</option>
                                 </select>
                             </div>
                         </form>
                     </div>
                     <div class="modal-footer">
                         <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                         <button type="button" class="btn btn-success" onclick="resolveComplaint()">Resolve Complaint</button>
                     </div>
                 </div>
             </div>
         </div>
         
         <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
         <script>
             // Function to view complaint details
             function viewComplaint(complaintId) {
                 fetch(`complaint/api/complaints/${complaintId}`)
                     .then(response => response.json())
                     .then(complaint => {
                         // Populate the modal with complaint details
                         document.getElementById('viewComplaintId').textContent = complaint.id;
                         document.getElementById('viewComplaintStatus').textContent = complaint.status;
                         document.getElementById('viewPassengerName').textContent = complaint.username;
                         document.getElementById('viewPassengerPNR').textContent = complaint.pnr;
                         document.getElementById('viewIssueType').textContent = complaint.issueDomain;
                         document.getElementById('viewCreatedAt').textContent = new Date(complaint.createdAt).toLocaleString();
                         document.getElementById('viewDescription').textContent = complaint.description;
                         
                         // Hide resolve button if already resolved
                         const resolveBtn = document.getElementById('resolveBtn');
                         if (complaint.status === 'Resolved') {
                             resolveBtn.style.display = 'none';
                         } else {
                             resolveBtn.style.display = 'block';
                         }
                         
                         // Show the modal
                         const viewModal = new bootstrap.Modal(document.getElementById('viewComplaintModal'));
                         viewModal.show();
                     })
                     .catch(error => {
                         console.error('Error fetching complaint details:', error);
                         alert('Failed to load complaint details. Please try again.');
                     });
             }
     
             // Function to show the resolve modal
             function showResolveModal(complaintId) {
                 // Hide the view modal if it's open
                 const viewModal = bootstrap.Modal.getInstance(document.getElementById('viewComplaintModal'));
                 if (viewModal) {
                     viewModal.hide();
                 }
                 
                 // Set the complaint ID in the resolve form
                 document.getElementById('resolveComplaintId').value = complaintId;
                 
                 // Clear previous form data
                 document.getElementById('resolutionDetails').value = '';
                 document.getElementById('resolutionCategory').value = '';
                 
                 // Show the resolve modal
                 const resolveModal = new bootstrap.Modal(document.getElementById('resolveComplaintModal'));
                 resolveModal.show();
             }
     
             // Function to resolve a complaint
             function resolveComplaint() {
                 const complaintId = document.getElementById('resolveComplaintId').value;
                 const resolutionDetails = document.getElementById('resolutionDetails').value;
                 const resolutionCategory = document.getElementById('resolutionCategory').value;
                 
                 // Simple validation
                 if (!resolutionDetails || !resolutionCategory) {
                     alert('Please fill in all the required fields.');
                     return;
                 }
                 
                 // Send the resolution data to the server
                 fetch(`complaint/api/complaints/${complaintId}/resolve`, {
                     method: 'PUT',
                     headers: {
                         'Content-Type': 'application/json'
                     },
                     body: JSON.stringify({
                         resolutionDetails,
                         resolutionCategory
                     })
                 })
                 .then(response => response.json())
                 .then(data => {
                     // Hide the modal
                     const resolveModal = bootstrap.Modal.getInstance(document.getElementById('resolveComplaintModal'));
                     resolveModal.hide();
                     
                     // Refresh the page to show updated data
                     window.location.reload();
                 })
                 .catch(error => {
                     console.error('Error resolving complaint:', error);
                     alert('Failed to resolve the complaint. Please try again.');
                 });
             }
         </script>
     </body>
     </html>
     

